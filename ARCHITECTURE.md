# ğŸ“Š Diamond Stock System - Visual Reference & Architecture

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ADMIN PANEL (Port 3000)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      HOME PAGE                           â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚    ğŸ’ à¦¸à§à¦Ÿà¦• à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡                              â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚          ğŸ’                           â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚   à¦°à§‡à¦®à§‡à¦‡à¦¨à¦¿à¦‚ à¦¸à§à¦Ÿà¦•: 9,600ğŸ’              â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚   [à¦¸à§à¦Ÿà¦• à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨ à¦¬à¦¾à¦Ÿà¦¨]              â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â”‚
â”‚  â”‚  â”‚    à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡ à¦°à¦¿à¦•à§‹à¦¯à¦¼à§‡à¦¸à§à¦Ÿ à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®                  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  à¦¸à§à¦Ÿà§à¦¯à¦¾à¦Ÿà¦¾à¦¸: ğŸŸ¢ à¦šà¦¾à¦²à§ (ON)              â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  à¦¬à¦¾à¦°à§à¦¤à¦¾: (Bengali message)            â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â”‚  [à¦Ÿà¦—à¦² à¦•à¦°à§à¦¨]  [à¦¬à¦¾à¦°à§à¦¤à¦¾ à¦¸à¦®à§à¦ªà¦¾à¦¦à¦¨]      â”‚  â”‚    â”‚  â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â”‚
â”‚  â”‚                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Socket.IO Real-time
           â”‚ Updates
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ADMIN SERVER (server.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  POST /api/diamond-status/set-stock                             â”‚
â”‚    â”œâ”€ Receive: { adminDiamondStock: 10000 }                    â”‚
â”‚    â”œâ”€ Update: diamond-status.json                              â”‚
â”‚    â”œâ”€ Broadcast: Socket.IO to all admins                       â”‚
â”‚    â””â”€ Response: { success, status }                            â”‚
â”‚                                                                  â”‚
â”‚  POST /api/diamond-status/toggle                                â”‚
â”‚    â”œâ”€ Toggle: systemStatus = on/off                            â”‚
â”‚    â”œâ”€ Notify: broadcastStatusToGroups()                        â”‚
â”‚    â””â”€ Response: { success, status }                            â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ HTTP Requests
           â”‚ (localhost:3001)
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              WHATSAPP BOT (Port 3001, index.js)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Receives: User diamond request (/d 100)                       â”‚
â”‚    â”‚                                                             â”‚
â”‚    â”œâ”€ handlers/diamond-request.js                              â”‚
â”‚    â”‚  â””â”€ handleDiamondRequest()                                â”‚
â”‚    â”‚     â””â”€ Check: getDiamondStatus()                          â”‚
â”‚    â”‚        â””â”€ If OFF: Return error                            â”‚
â”‚    â”‚        â””â”€ If ON: Create pending order                     â”‚
â”‚    â”‚                                                             â”‚
â”‚    â””â”€ Admin approves order                                      â”‚
â”‚       â””â”€ approvePendingDiamond()                               â”‚
â”‚          â””â”€ Call: deductAdminDiamondStock(100)                â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”œâ”€ Read: diamond-status.json                       â”‚
â”‚             â”œâ”€ Check: currentStock >= 100?                     â”‚
â”‚             â”‚                                                   â”‚
â”‚             â”œâ”€ YES:                                             â”‚
â”‚             â”‚  â”œâ”€ Deduct: stock = stock - 100                 â”‚
â”‚             â”‚  â”œâ”€ Save: diamond-status.json                   â”‚
â”‚             â”‚  â”œâ”€ Check: stock == 0?                          â”‚
â”‚             â”‚  â”‚  â”œâ”€ YES: Set systemStatus = "off"            â”‚
â”‚             â”‚  â”‚  â”‚        Call toggleOff()                   â”‚
â”‚             â”‚  â”‚  â”‚        Broadcast OFF to groups            â”‚
â”‚             â”‚  â”‚  â””â”€ NO: Send stock update to group           â”‚
â”‚             â”‚  â””â”€ Return: { success: true, newStock }         â”‚
â”‚             â”‚                                                   â”‚
â”‚             â””â”€ NO:                                              â”‚
â”‚                â”œâ”€ Don't deduct                                  â”‚
â”‚                â””â”€ Return error: "à¦…à¦ªà¦°à§à¦¯à¦¾à¦ªà§à¦¤ à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡"           â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± UI Components

### Stock Card (Home Page)
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ’ à¦¸à§à¦Ÿà¦• à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                                        â•‘
â•‘  â”‚   ğŸ’   â”‚  à¦°à§‡à¦®à§‡à¦‡à¦¨à¦¿à¦‚ à¦¸à§à¦Ÿà¦•: 9,600ğŸ’           â•‘
â•‘  â”‚ Green  â”‚                                        â•‘
â•‘  â”‚ 70px   â”‚  [à¦¸à§à¦Ÿà¦• à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨]                    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                        â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Colors:
- Border: #43e97b (Green)
- Stock Amount: #43e97b (Green, Large)
- Background: rgba(67, 233, 123, 0.1)
- Icon: 70px circle with gradient
```

### Edit Stock Modal
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         ğŸ’ à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡ à¦¸à§à¦Ÿà¦• à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨    [âœ•]        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                    â•‘
â•‘  ğŸ’ à¦®à§‹à¦Ÿ à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡ à¦¸à§à¦Ÿà¦•:                           â•‘
â•‘  [                    10000                      ]â•‘
â•‘                                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘  â”‚ â„¹ï¸ à¦¯à¦–à¦¨ à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¬à§‡, à¦¸à¦¿à¦¸à§à¦Ÿà§‡à¦®           â”‚   â•‘
â•‘  â”‚ à¦¸à§à¦¬à¦¯à¦¼à¦‚à¦•à§à¦°à¦¿à¦¯à¦¼à¦­à¦¾à¦¬à§‡ à¦¬à¦¨à§à¦§ à¦¹à¦¯à¦¼à§‡ à¦¯à¦¾à¦¬à§‡ à¦à¦¬à¦‚     â”‚   â•‘
â•‘  â”‚ à¦¸à¦•à¦² à¦—à§à¦°à§à¦ªà§‡ à¦¬à¦¾à¦°à§à¦¤à¦¾ à¦ªà¦¾à¦ à¦¾à¦¨à§‹ à¦¹à¦¬à§‡à¥¤         â”‚   â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                    â•‘
â•‘  [à¦¸à¦‚à¦°à¦•à§à¦·à¦£ à¦•à¦°à§à¦¨]  [à¦¬à¦¾à¦¤à¦¿à¦²]                       â•‘
â•‘                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”„ Data Flow Diagram

### Setting Stock
```
Admin Panel
    â”‚
    â”œâ”€ Click: "à¦¸à§à¦Ÿà¦• à¦¸à§‡à¦Ÿ à¦•à¦°à§à¦¨"
    â”‚
    â”œâ”€ Modal opens
    â”‚    â”‚
    â”‚    â””â”€ Enter: 10000
    â”‚
    â”œâ”€ Click: "à¦¸à¦‚à¦°à¦•à§à¦·à¦£ à¦•à¦°à§à¦¨"
    â”‚    â”‚
    â”‚    â”œâ”€ POST /api/diamond-status/set-stock
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Backend validates
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Update diamond-status.json
    â”‚    â”‚    â”‚    â””â”€ adminDiamondStock: 10000
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ io.emit('diamondStatusChanged')
    â”‚    â”‚    â”‚
    â”‚    â”‚    â””â”€ Return: { success: true }
    â”‚    â”‚
    â”‚    â”œâ”€ Close modal
    â”‚    â”‚
    â”‚    â””â”€ Show toast: "à¦¸à§à¦Ÿà¦• à¦¸à¦‚à¦°à¦•à§à¦·à¦£ à¦¹à¦¯à¦¼à§‡à¦›à§‡: 10,000 ğŸ’"
    â”‚
    â””â”€ Home page updates
         â””â”€ Shows: "à¦°à§‡à¦®à§‡à¦‡à¦¨à¦¿à¦‚ à¦¸à§à¦Ÿà¦•: 10,000ğŸ’"
```

### Order Approval & Stock Deduction
```
User in WhatsApp
    â”‚
    â”œâ”€ Sends: /d 100
    â”‚
    â”œâ”€ Bot receives
    â”‚
    â”œâ”€ Check: getDiamondStatus()
    â”‚    â””â”€ systemStatus = "on"? YES
    â”‚
    â”œâ”€ Create pending order
    â”‚
    â”œâ”€ Notify admin panel
    â”‚
Admin Panel
    â”‚
    â”œâ”€ Click: Approve
    â”‚
    â”œâ”€ Call: approvePendingDiamond()
    â”‚    â”‚
    â”‚    â”œâ”€ Call: deductAdminDiamondStock(100)
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Read: diamond-status.json
    â”‚    â”‚    â”‚    â””â”€ Current stock: 10,000
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Check: 10,000 >= 100? YES
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Deduct: 10,000 - 100 = 9,900
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Save: diamond-status.json
    â”‚    â”‚    â”‚    â””â”€ adminDiamondStock: 9,900
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ Check: stock == 0? NO
    â”‚    â”‚    â”‚
    â”‚    â”‚    â””â”€ Return: { success: true, newStock: 9,900 }
    â”‚    â”‚
    â”‚    â”œâ”€ Update user balance (auto-deduction)
    â”‚    â”‚
    â”‚    â””â”€ Return approval message with stock info
    â”‚
    â”œâ”€ Send message to group:
    â”‚    â””â”€ "âœ… Approved\nğŸ’ à¦°à§‡à¦®à§‡à¦‡à¦¨à¦¿à¦‚ à¦¸à§à¦Ÿà¦•: 9,900ğŸ’"
    â”‚
    â””â”€ Admin panel updates
         â””â”€ Stock card shows: 9,900ğŸ’
```

### Auto-OFF Scenario
```
Stock: 100ğŸ’
Pending Order: 100ğŸ’
    â”‚
    â”œâ”€ Admin approves
    â”‚
    â”œâ”€ deductAdminDiamondStock(100)
    â”‚    â”‚
    â”‚    â”œâ”€ 100 - 100 = 0
    â”‚    â”‚
    â”‚    â”œâ”€ Check: stock == 0? YES
    â”‚    â”‚
    â”‚    â”œâ”€ Set: systemStatus = "off"
    â”‚    â”‚
    â”‚    â”œâ”€ Set: globalMessage = "à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡..."
    â”‚    â”‚
    â”‚    â”œâ”€ Save: diamond-status.json
    â”‚    â”‚
    â”‚    â””â”€ Return: { success: true, stockDepleted: true }
    â”‚
    â”œâ”€ Call: POST /api/diamond-status/toggle
    â”‚    â”‚
    â”‚    â”œâ”€ Set: systemStatus = "off"
    â”‚    â”‚
    â”‚    â”œâ”€ Call: broadcastStatusToGroups()
    â”‚    â”‚    â”‚
    â”‚    â”‚    â”œâ”€ For each group:
    â”‚    â”‚    â”‚    â””â”€ POST /api/send-group-message
    â”‚    â”‚    â”‚       Message: "âŒ à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡..."
    â”‚    â”‚    â”‚
    â”‚    â”‚    â””â”€ io.emit('statusUpdated')
    â”‚    â”‚
    â”‚    â””â”€ Return: { success: true }
    â”‚
    â”œâ”€ Admin panel
    â”‚    â”œâ”€ Stock shows: 0ğŸ’
    â”‚    â”œâ”€ Status: ğŸ”´ à¦¬à¦¨à§à¦§ (OFF)
    â”‚    â””â”€ Message: "à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡"
    â”‚
    â”œâ”€ All Groups receive:
    â”‚    â””â”€ "âŒ à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡à¥¤ à¦¶à§€à¦˜à§à¦°à¦‡ à¦«à¦¿à¦°à§‡ à¦†à¦¸à¦¬à§‡à¥¤"
    â”‚
    â””â”€ New Orders
         â””â”€ All rejected with: "Diamond Requests Currently OFF"
```

---

## ğŸ’¾ Configuration State Machine

```
STATE 1: Initial
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemStatus: off                    â”‚
â”‚ adminDiamondStock: 0                 â”‚
â”‚ globalMessage: ""                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Admin sets stock
         â–¼
STATE 2: Stock Set
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemStatus: on                     â”‚
â”‚ adminDiamondStock: 10000             â”‚
â”‚ globalMessage: "à¦¸à§à¦Ÿà¦• à¦ªà§à¦°à¦¸à§à¦¤à§à¦¤..."   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Orders approved (stock deducts)
         â–¼
STATE 3: Running
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemStatus: on                     â”‚
â”‚ adminDiamondStock: 500 (decreasing)  â”‚
â”‚ globalMessage: "Order accepted"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Stock reaches 0
         â–¼
STATE 4: Depleted
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemStatus: off                    â”‚
â”‚ adminDiamondStock: 0                 â”‚
â”‚ globalMessage: "à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦·..."        â”‚
â”‚ autoOffAt: timestamp                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ Admin sets new stock
         â–¼
STATE 5: Reloaded
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ systemStatus: on                     â”‚
â”‚ adminDiamondStock: 5000              â”‚
â”‚ globalMessage: "Stock refilled"      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Validation Flow

```
Order Approval Request
    â”‚
    â”œâ”€ Validate: diamondCount > 0?
    â”‚    â””â”€ If NO: Reject
    â”‚
    â”œâ”€ Validate: diamondCount <= 10000?
    â”‚    â””â”€ If NO: Reject
    â”‚
    â”œâ”€ Check: systemStatus == "on"?
    â”‚    â””â”€ If NO: Reject with error
    â”‚
    â”œâ”€ Check: adminDiamondStock >= diamondCount?
    â”‚    â”‚
    â”‚    â”œâ”€ If NO: Reject with error
    â”‚    â”‚           "à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦•à¦¾à¦›à§‡ à¦¯à¦¥à§‡à¦·à§à¦Ÿ à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡ à¦¨à§‡à¦‡"
    â”‚    â”‚
    â”‚    â””â”€ If YES: Proceed
    â”‚
    â”œâ”€ Approve: Set status = "approved"
    â”‚
    â”œâ”€ Deduct: stock = stock - diamondCount
    â”‚
    â”œâ”€ Check: stock == 0?
    â”‚    â”‚
    â”‚    â”œâ”€ If YES: Auto-OFF system
    â”‚    â”‚
    â”‚    â””â”€ If NO: Continue
    â”‚
    â””â”€ Return: Success message
```

---

## ğŸ“Š Real-time Update Flow (Socket.IO)

```
Admin Panel A                Admin Panel B
      â”‚                           â”‚
      â”‚ Sets stock: 10000        â”‚
      â”‚                           â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
              Admin Server
                    â”‚
           io.emit('diamondStatusChanged')
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
    Admin A                 Admin B
   Updates UI            Updates UI
  Shows 10,000          Shows 10,000
   Stock Card           Stock Card
```

---

## ğŸš¨ Error Handling

```
Error Scenarios:

1. Insufficient Stock
   User: /d 1000
   Stock: 500
   Result: âŒ Rejected
           Message: "à¦…à§à¦¯à¦¾à¦¡à¦®à¦¿à¦¨à§‡à¦° à¦•à¦¾à¦›à§‡ à¦¯à¦¥à§‡à¦·à§à¦Ÿ à¦¡à¦¾à¦¯à¦¼à¦®à¦¨à§à¦¡ à¦¨à§‡à¦‡"
           Stock: Unchanged

2. System OFF
   User: /d 100
   Status: OFF
   Result: âŒ Rejected
           Message: "Diamond Requests Currently OFF"
           Stock: Unchanged

3. Invalid Amount
   User: /d -50
   Result: âŒ Rejected
           Message: "Invalid diamond amount"
           Stock: Unchanged

4. File Write Error
   Result: âœ… Fallback to memory
           Log: Error in logs
           Stock: Rolled back safely
```

---

## ğŸ“ˆ Database Operations

```
Operation: SET STOCK

Before:
{
    "systemStatus": "on",
    "adminDiamondStock": 500,
    "lastStockUpdate": "2024-01-15T10:00:00.000Z"
}

After: (Admin sets to 10000)
{
    "systemStatus": "on",
    "adminDiamondStock": 10000,
    "lastStockUpdate": "2024-01-15T10:05:30.000Z"
}

---

Operation: DEDUCT STOCK

Before:
{
    "systemStatus": "on",
    "adminDiamondStock": 10000
}

After: (Order for 100 approved)
{
    "systemStatus": "on",
    "adminDiamondStock": 9900,
    "lastStockDeduction": "2024-01-15T10:06:45.000Z"
}

---

Operation: AUTO-OFF

Before:
{
    "systemStatus": "on",
    "adminDiamondStock": 50
}

After: (Order for 50 approved)
{
    "systemStatus": "off",
    "adminDiamondStock": 0,
    "globalMessage": "à¦¸à§à¦Ÿà¦• à¦¶à§‡à¦· à¦¹à¦¯à¦¼à§‡ à¦—à§‡à¦›à§‡...",
    "autoOffAt": "2024-01-15T10:07:20.000Z"
}
```

---

**System Architecture: Complete âœ…**
**All diagrams show actual implementation.**
